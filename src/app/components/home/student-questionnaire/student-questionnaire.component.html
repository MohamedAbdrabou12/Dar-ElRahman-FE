@if (rowSelected) {
  <div class="d-flex justify-content-between details-container">
    <div class="card">
      <div class="card-body">
        <h3 class="card-title">بيانات الطالب</h3>
        <p class="d-flex justify-content-between">
          <strong>رقم المسلسل:</strong> {{ rowSelected?.student?.id }}
        </p>
        <p class="d-flex justify-content-between">
          <strong>الاسم رباعي:</strong> {{ rowSelected?.student?.fullName }}
        </p>
        <p class="d-flex justify-content-between">
          <strong>الرقم القومي:</strong> {{ rowSelected?.student?.nationalId }}
        </p>
        <p class="d-flex justify-content-between">
          <strong>الحالة:</strong>
          <span
            class="green-status"
            [ngClass]="{
            'green-status': rowSelected?.student?.status === 'connected',
            'green-danger': rowSelected?.student?.status === 'stopped'
          }"
          >{{ rowSelected?.student?.status === "stopped" ? "منقطع" : "متصل" }}</span
          >
        </p>
      </div>
    </div>

    <div class="card">
      <div class="card-body">
        <h3 class="card-title">بيانات السؤال</h3>
        <p class="d-flex justify-content-between">
          <strong>رقم المسلسل:</strong> {{ rowSelected?.questionnaire?.id }}
        </p>
        <p class="d-flex justify-content-between">
          <strong>نوع الحفظ:</strong> {{ rowSelected?.questionnaire?.questionnaireType === QuestionnaireType.memorization ? 'تسميع' : 'مراجعة' }}
        </p>
        <p class="d-flex justify-content-between">
          <strong>نوع السؤال:</strong> {{ rowSelected?.questionnaire?.questionType === QuestionType.first ? 'أول' : (rowSelected?.questionnaire?.questionType === QuestionType.second ? 'ثالث' : 'ثانى') }}
        </p>
        <p class="d-flex justify-content-between">
          <strong>تاريخ السؤال:</strong> {{ rowSelected?.questionnaire?.questionDate | date: 'yyyy-MM-dd' }}
        </p>
        <p class="d-flex justify-content-between">
          <strong>السورة الحالية:</strong> {{ rowSelected?.questionnaire?.currentSurah?.nameAr }}
        </p>
        <p class="d-flex justify-content-between">
          <strong>الحلقة:</strong> {{ rowSelected?.questionnaire?.ring?.name }}
        </p>
      </div>
    </div>

    <!-- Student Results Card -->
    <div class="card">
      <div class="card-body">
        <h3 class="card-title">نتيجة الطالب</h3>
        <p class="d-flex justify-content-between">
          <strong>تاريخ السؤال:</strong> {{ rowSelected?.questionnaire?.questionDate | date: 'yyyy-MM-dd' }}
        </p>
        <p class="d-flex justify-content-between">
          <strong>التقدير:</strong> {{ getArabicGrade(rowSelected?.grade) }}
        </p>
      </div>
    </div>
  </div>
}

<!-- Button to trigger the modal -->
<button
  type="button"
  class="details-button add-button btn"
  data-bs-toggle="modal"
  data-bs-target="#questionnaireModal"
  (click)="handleAddClick()"
>
  اضافة نتيجة جديدة
</button>

<!-- Modal -->
<div
  #questionnaireModal
  class="modal fade"
  id="questionnaireModal"
  tabindex="-1"
  aria-labelledby="questionnaireModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <div *ngIf="error" class="alert alert-danger">
          {{ error.error.errorDescription }}
        </div>
        <h5 class="modal-title" id="questionnaireModalLabel">بيانات النتيجة</h5>
      </div>
      <div class="modal-body">
        <form
          [formGroup]="studentQuestionnaireForm"
          (ngSubmit)="onSubmit()"
        >
          <div class="mb-3">
            <label for="ring">الحلقة</label>
            <select id="ring" formControlName="ringId" (change)="onRingChange($event)" class="form-control">
              <option *ngFor="let ring of rings" [value]="ring.id">{{ ring.name }}</option>
            </select>
          </div>

          <div class="mb-3">
            <label for="questionnaire">السؤال</label>
            <select id="questionnaire" formControlName="questionnaireId" (change)="onQuestionnaireChange($event)" class="form-control">
              <option *ngFor="let q of questionnaires" [value]="q.id">{{ q.questionnaireType }} - {{ q.questionDate | date }}</option>
            </select>
          </div>

          <div class="mb-3">
            <label for="student">الطالب</label>
            <select id="student" formControlName="studentId" class="form-control">
              <option *ngFor="let student of students" [value]="student.id">{{ student.fullName }}</option>
            </select>
          </div>

          <div class="mb-3">
            <label for="grade">التقدير</label>
            <select id="grade" formControlName="grade" class="form-control">
              <option *ngFor="let grade of grades" [value]="grade">{{ getArabicGrade(grade) }}</option>
            </select>
          </div>

          <div class="mb-3 modal-footer d-flex justify-content-end">
            <div>
              <button
                type="submit"
                [disabled]="studentQuestionnaireForm.invalid"
                class="details-button btn"
              >
                {{ buttonName }}
              </button>
            </div>
            <div>
              <button
                type="button"
                class="danger-button btn"
                (click)="closeModal()"
                data-bs-dismiss="modal"
              >
                الغاء
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<hr>

<h2>تصفية أسئلة الطلبة</h2>
<form [formGroup]="filterForm" class="filter-form">
  <div class="row">
    <div class="col-md-4">
      <div class="mb-3">
        <label for="filter-ring">الحلقة</label>
        <select id="filter-ring" formControlName="ringId" class="form-control">
          <option [ngValue]="null">الكل</option>
          <option *ngFor="let ring of rings" [value]="ring.id">{{ ring.name }}</option>
        </select>
      </div>
    </div>
    <div class="col-md-4">
      <div class="mb-3">
        <label for="filter-student">الطالب</label>
        <input id="filter-student" type="text" formControlName="studentName" class="form-control" placeholder="ابحث باسم الطالب...">
      </div>
    </div>
    <div class="col-md-4">
      <div class="mb-3">
        <label for="filter-grade">التقدير</label>
        <select id="filter-grade" formControlName="grade" class="form-control">
          <option [ngValue]="null">الكل</option>
          <option *ngFor="let grade of grades" [value]="grade">{{ getArabicGrade(grade) }}</option>
        </select>
      </div>
    </div>
    <div class="col-md-4">
      <div class="mb-3">
        <label for="filter-questionnaire">السؤال</label>
        <select id="filter-questionnaire" formControlName="questionnaireId" class="form-control">
          <option [ngValue]="null">الكل</option>
          <option *ngFor="let q of questionnairesForFilter" [value]="q.id">{{ q.questionnaireType }} - {{ q.questionDate | date }}</option>
        </select>
      </div>
    </div>
    <div class="col-md-4">
      <div class="mb-3">
        <label for="filter-date">تاريخ السؤال</label>
        <input id="filter-date" type="date" formControlName="questionDate" class="form-control">
      </div>
    </div>
  </div>
</form>

<div class="table-container">
  <h2 *ngIf="!studentQuestionnaires || studentQuestionnaires.length == 0">لم يتم تسجيل أي نتائج حتى الآن.</h2>
  <table class="custom-table" *ngIf="studentQuestionnaires && studentQuestionnaires.length > 0">
    <thead class="thead-dark">
    <tr>
      <th>اسم الطالب</th>
      <th>الحلقة</th>
      <th>نوع السؤال</th>
      <th>تاريخ السؤال</th>
      <th>التقدير</th>
      <th>العمليات</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let item of studentQuestionnaires">
      <td>{{ item.student?.fullName }}</td>
      <td>{{ item.questionnaire?.ring?.name }}</td>
      <td>{{ item.questionnaire?.questionnaireType === QuestionnaireType.memorization ? 'تسميع' : 'مراجعة' }}</td>
      <td>{{ item.questionnaire?.questionDate | date: 'shortDate' }}</td>
      <td>{{ getArabicGrade(item.grade) }}</td>
      <td>
        <div class="d-flex justify-content-between">
          <button class="btn-sm details-button" (click)="onRowClick(item)">
            <i class="fa fa-eye"></i>
            <span>البيانات</span>
          </button>
          <button
            class="btn-sm edit-button"
            (click)="handleEditClick(item)"
            type="button"
            data-bs-toggle="modal"
            data-bs-target="#questionnaireModal"
          >
            <i class="fa fa-edit"></i>
            <span>تعديل</span>
          </button>
          <button class="btn-sm delete-button" (click)="onDelete(item.id!)">
            <i class="fa fa-trash"></i>
            <span>حذف</span>
          </button>
        </div>
      </td>
    </tr>
    </tbody>
  </table>
</div>
